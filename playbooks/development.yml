---
- hosts: localhost
  tasks:

    # -------------------------------------------------------------------------
    # External playbooks
    # -------------------------------------------------------------------------

    - include: development/postgresql.yml
    - include: development/ruby.yml
    - include: development/erlang.yml


    # -------------------------------------------------------------------------
    # Inline setup
    # -------------------------------------------------------------------------

    - name: "temp directory for storing source code archives of compiled warez"
      file:
        path: "{{home}}/src"
        state: directory

    - name: "local bin directory"
      file:
        path: "{{home}}/bin"
        state: directory

    - dnf:
        name: "{{item}}"
        state: latest
      become: true
      with_items:
        - git
        - tmux
        - vim
        - the_silver_searcher
        - "@C Development Tools and Libraries"
        - pass
        - optipng
        - htop
        - java-1.8.0-openjdk
        - python-pygments
        - nmap
        - ImageMagick
        - perf
        - dstat
        - redhat-rpm-config
        - python3-devel
        - python2-virtualenv
        - rpm-build

    - pip:
        name: "{{item}}"
        state: present
      become: true
      with_items:
        - awscli
        - httpstat

    - shell: curl -Ls https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-126.0.0-linux-x86_64.tar.gz | tar xz && \
        mv ./google-cloud-sdk ~/bin/gcloudsdk
      args:
        chdir: "{{home}}/src"
        creates: "{{home}}/bin/gcloudsdk"

    - shell: curl -Ls https://cli-assets.heroku.com/branches/stable/heroku-linux-amd64.tar.gz | tar xzC {{home}}/bin
      args:
        creates: "{{home}}/bin/heroku"

    - file:
        path: "{{home}}/.env"
        state: touch
    - lineinfile:
        line: export PATH=$HOME/bin/gcloudsdk/bin:$HOME/bin/heroku/bin:$PATH
        dest: "{{home}}/.env"

    - git:
        repo: https://github.com/jhawthorn/fzy.git
        dest: "{{home}}/src/fzy"
    - shell: "make && make install"
      become: true
      args:
        chdir: "{{home}}/src/fzy"

    - name: "disable gross vim defaults"
      copy:
        dest: /etc/vimrc
        content: ""
      become: true

    - name: "disable stupid ls colors"
      copy:
        dest: /etc/profile.d/colorls.sh
        content: ""
      become: true
